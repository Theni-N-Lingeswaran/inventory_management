<div class="card-body">
	<table id="complaints_table" class="table table-bordered table-striped  table-hover">
	  <thead>
	    <tr>
	      <th>Customer Name</th>
	      <th>Contact Number</th>
	      <th>Product Category</th>
	      <th>Product Name</th>
	      <th>Product Details</th>
	      <th>Product Complaint</th>
        <th>Reported By</th>
	      <th>Total Amount</th>
        <th>Remaining Amount</th>
	      <th>Status</th>
	      <th>Invoice(s)</th>
	    </tr>
	  </thead>
	  <tbody>
	    <%@all_complaints.each do |all_complaint|%>
	      <% int_status = all_complaint.read_attribute_before_type_cast('status').to_i %>
	      <tr>
	        <td><%=all_complaint.product&.customers[0]&.customer_name&.capitalize%></td>
	        <td><%=all_complaint.product&.customers[0]&.customer_phone&.capitalize%></td>
	        <td><%=all_complaint.product&.category&.category_name&.capitalize%> / <%=all_complaint.product&.category&.category&.category_name&.capitalize%></td>
	        <td><%=all_complaint.product&.product_name&.capitalize%></td>
	        <td><%=all_complaint.product&.product_code&.capitalize%></td>
	        <td><%=all_complaint.complaint_details&.capitalize%></td>
          <td><%=all_complaint.user&.contact_name&.capitalize%></td>
	        <td><%=all_complaint.total_amount||all_complaint.total_amount%></td>

          <%remaining_amount = (all_complaint.total_amount.to_i - all_complaint&.invoices&.sum(:part_amount).to_i)%>
          <td style='background: <%= int_status == 3 ? '#049d0438' : remaining_amount != 0 ? '#f344007d' : '#049d0438'%>'> <%=remaining_amount%></td>
	        <td><span class="badge badge-<%= int_status == 1 ? 'warning' : int_status == 2 ? 'info' : int_status == 3 ? 'success' : 'danger' %>"><%=all_complaint&.status&.capitalize%></span></td>
	        <td><%=all_complaint&.invoices.size%></td>
	      </tr>
	    <%end%>
	  </tbody>
	</table>
</div>

<script>
  $(function () {
    $("#complaints_table").DataTable({
      buttons: ["copy", "csv", "excel", "pdf", "print"],
      responsive: true,
      stateSave: true,
      lengthChange: false,
      autoWidth: false,
      paging: true,
      lengthChange: false,
      searching: true,
      ordering: true,
      info: true,
      scrollX: false,
      scrollCollapse: true,
    }).buttons().container().appendTo('#complaints_table_wrapper .col-md-6:eq(0)');

    // $('#complaints_table_filter').append('<label>Filter:<div id="status_filter"></div></label>');
    // VirtualSelect.init({
    //   ele: '#status_filter',
    //   hideClearButton: false,
    //   multiple: false,
    //   search: false,
    //   placeholder: 'Complaint Status',
    //   options: [
    //     { label: 'Pending', value: 0 },
    //     { label: 'Processing', value: 1 },
    //     { label: 'Resolved', value: 2 },
    //     { label: 'Delivered', value: 3 }
    //   ],
    //   noOptionsText: 'No results found',
    //   dropboxWidth: 'auto',
    //   zIndex: 10,
    //   markSearchResults: false,
    //   showSelectedOptionsFirst: true,
    //   hasOptionDescription: true,
    //   // onServerSearch: onSampleSelectServerSearch,
    //   showValueAsTags: false,
    //   keepAlwaysOpen: false,
    //   allowNewOption: false,
    //   maxValues: false,
    //   disabledOptions: [],
    //   selectedValue: [],
    //   itemHeight: '10px',
    //   optionHeight: '40px',
    //   noOptionsText: 'No results found',
    //   optionSelectedText: 'option selected',
    //   searchPlaceholderText: 'search',
    // });
  });
</script>