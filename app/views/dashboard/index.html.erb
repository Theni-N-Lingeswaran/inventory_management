<section class="content">
  <div class="container-fluid">
    <div class="row mt-3">

      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box mb-3">
          <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-users"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Total Customers</span>
            <span class="info-box-number"><%= Customer.all.count%></span>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box mb-3">
          <span class="info-box-icon bg-success elevation-1"><i class="fas fa-comment"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">All Complaints</span>
            <span class="info-box-number"><%= Compliant.count%></span>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box mb-3">
          <span class="info-box-icon bg-danger elevation-1"><i class="fas fa-comment"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Open Complaints</span>
            <span class="info-box-number"><%= Compliant.where.not(status: 3).count%></span>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box mb-3">
          <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-comment"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Resolved Complaints</span>
            <span class="info-box-number"><%= Compliant.where(status: 2).count%></span>
          </div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Overview Report</h5>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>

          <div class="card-body">
            <table id="overall_table" class="table table-bordered table-striped  table-hover">
              <thead>
                <tr>
                  <th>Customer Name</th>
                  <th>Contact Number</th>
                  <th>Product Category</th>
                  <th>Product Sub-Category</th>
                  <th>Product Name</th>
                  <th>Product Details</th>
                  <th>Product Complaint</th>
                  <th>Total Amount</th>
                  <th>Status</th>
                  <th>Invoice(s)</th>
                </tr>
              </thead>
              <tbody>
                <%@all_compliants.each do |all_compliant|%>
                  <% int_status = all_compliant.read_attribute_before_type_cast('status').to_i %>
                  <tr>
                    <td><%=all_compliant&.product&.customers[0]&.customer_name&.capitalize%></td>
                    <td><%=all_compliant&.product&.customers[0]&.customer_phone&.capitalize%></td>
                    <td><%=all_compliant&.product&.sub_category&.category&.category_name&.capitalize%></td>
                    <td><%=all_compliant&.product&.sub_category&.sub_category_name&.capitalize%></td>
                    <td><%=all_compliant&.product&.product_name&.capitalize%></td>
                    <td><%=all_compliant&.product&.product_code&.capitalize%></td>
                    <td><%=all_compliant&.complaint_details&.capitalize%></td>
                    <td><%=all_compliant&.total_amount||'--'%></td>
                    <td><span class="badge badge-<%= int_status == 1 ? 'warning' : int_status == 2 ? 'info' : int_status == 3 ? 'success' : 'danger' %>"><%=all_compliant&.status&.capitalize%></span></td>
                    <td><%=all_compliant&.invoices.size%></td>
                  </tr>
                <%end%>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $(function () {
    $("#overall_table").DataTable({
      buttons: ["copy", "csv", "excel", "pdf", "print"],
      responsive: true,
      stateSave: true,
      lengthChange: false,
      autoWidth: false,
      paging: true,
      lengthChange: false,
      searching: true,
      ordering: true,
      info: true,
      scrollX: false,
      // scrollY: '50vh',
      scrollCollapse: true,
    }).buttons().container().appendTo('#overall_table_wrapper .col-md-6:eq(0)');
  });
</script>